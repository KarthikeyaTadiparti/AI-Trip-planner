import {
    GoogleGenerativeAI,
    HarmCategory,
    HarmBlockThreshold,
} from "@google/generative-ai";

const apiKey = process.env.GEMINI_API_KEY;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
    model: "gemini-2.0-flash",
});

const generationConfig = {
    temperature: 1,
    topP: 0.95,
    topK: 40,
    maxOutputTokens: 8192,
    responseMimeType: "application/json",
};

export const chatSession = model.startChat({
    generationConfig,
    history: [
        {
            role: "user",
            parts: [
                {
                    text: "Generate Travel Plan for Location : Las Vegas, for 3 Days for Couple with a Cheap budget ,Give me a Hotels options list with HotelName, Hotel address, Price, hotel image url, geo coordinates, rating, descriptions and suggest itinerary with placeName, Place Details, Place Image Url, Geo Coordinates, ticket Pricing, rating, Time travel each of the location for 3 days with each day plan with best time to visit in JSON format.",
                },
            ],
        },
        {
            role: "model",
            parts: [
                {
                    text: '```json\n{\n  "tripDetails": {\n    "location": "Las Vegas, Nevada",\n    "duration": "3 Days",\n    "budget": "Cheap/Budget-Friendly",\n    "travelers": "Couple"\n  },\n  "hotelOptions": [\n    {\n      "hotelName": "Circus Circus Hotel & Casino",\n      "hotelAddress": "2880 S Las Vegas Blvd, Las Vegas, NV 89109",\n      "price": 40,\n      "hotelImageUrl": "https://www.kayak.com/rimg/himg/ca/61/55/expediav2-12828-7d79080a_s-548981.jpg?width=720&height=576&crop=true",\n      "geoCoordinates": {\n        "latitude": 36.1260,\n        "longitude": -115.1681\n      },\n      "rating": 3.5,\n      "description": "Budget-friendly option on the Strip. Offers free circus acts, a large Adventuredome theme park (additional cost), and basic amenities.  Rooms are simple but clean."\n    },\n    {\n      "hotelName": "Stratosphere Hotel, Casino & Tower",\n      "hotelAddress": "2000 S Las Vegas Blvd, Las Vegas, NV 89104",\n      "price": 50,\n      "hotelImageUrl": "https://www.vegas.com/wp-content/uploads/2023/03/stratosphere_exterior-1.jpg",\n      "geoCoordinates": {\n        "latitude": 36.1474,\n        "longitude": -115.1555\n      },\n      "rating": 3.0,\n      "description": "Located at the northern end of the Strip. Offers great views from the tower (ticketed), a casino, and affordable dining options. Rooms are basic but serviceable."\n    },\n    {\n      "hotelName": "Excalibur Hotel & Casino",\n      "hotelAddress": "3850 S Las Vegas Blvd, Las Vegas, NV 89109",\n      "price": 60,\n      "hotelImageUrl": "https://media-cdn.tripadvisor.com/media/photo-s/1b/85/08/99/excalibur-hotel-casino.jpg",\n      "geoCoordinates": {\n        "latitude": 36.0984,\n        "longitude": -115.1744\n      },\n      "rating": 4.0,\n      "description": "Medieval-themed hotel on the south Strip. Features budget-friendly dining, a large casino, and a family-friendly atmosphere. Rooms are comfortable and well-maintained."\n    }\n  ],\n  "itinerary": {\n    "day1": {\n      "theme": "Exploring the Strip (South End & Free Attractions)",\n      "morning": {\n        "placeName": "Welcome to Las Vegas Sign",\n        "placeDetails": "Iconic photo opportunity.  Get there early to avoid crowds.",\n        "placeImageUrl": "https://www.lasvegasadvisor.com/wp-content/uploads/2021/12/Las-Vegas-Sign-Front-Wide.jpg",\n        "geoCoordinates": {\n          "latitude": 36.0829,\n          "longitude": -115.1733\n        },\n        "ticketPricing": "Free",\n        "rating": 4.5,\n        "bestTimeToVisit": "Early morning (before 9 AM)",\n        "travelTimeFromHotel": "Varies depending on hotel location (allow 15-30 minutes by car/bus from most Strip hotels)"\n      },\n      "afternoon": {\n        "placeName": "Bellagio Conservatory & Botanical Garden",\n        "placeDetails": "Stunning floral displays that change seasonally.  Completely free.",\n        "placeImageUrl": "https://www.bellagio.com/content/dam/MGM/bellagio/entertainment/conservatory-botanical-garden/bellagio-conservatory-chinese-new-year-2023-hero.jpg",\n        "geoCoordinates": {\n          "latitude": 36.1126,\n          "longitude": -115.1746\n        },\n        "ticketPricing": "Free",\n        "rating": 4.8,\n        "bestTimeToVisit": "Anytime",\n        "travelTimeFromPrevious": "10-15 minutes walking from Welcome to Las Vegas Sign (or quicker by bus/ride-share)"\n      },\n      "evening": {\n        "placeName": "Bellagio Fountain Show",\n        "placeDetails": "Spectacular water show choreographed to music. Free and runs every 30 minutes in the afternoon/early evening, and every 15 minutes in the late evening.",\n        "placeImageUrl": "https://www.bellagio.com/content/dam/MGM/bellagio/entertainment/fountains-of-bellagio/fountains-of-bellagio-mobile.jpg",\n        "geoCoordinates": {\n          "latitude": 36.1126,\n          "longitude": -115.1746\n        },\n        "ticketPricing": "Free",\n        "rating": 4.9,\n        "bestTimeToVisit": "Evening (for the lights)",\n        "travelTimeFromPrevious": "Adjacent to the Conservatory (same location)"\n      },\n      "dinner": {\n        "placeName": "In-N-Out Burger",\n        "placeDetails": "Classic West Coast burger chain.  Affordable and delicious. Multiple locations, including one near the Strip.",\n        "placeImageUrl": "https://cdn.vox-cdn.com/thumbor/776gL2l9XwVb1NfW8Qv6yR2eQo8=/0x0:2040x1360/1200x800/filters:focal(857x517:1183x843)/cdn.vox-cdn.com/uploads/chorus_image/image/64035794/In_N_Out_Burger_Las_Vegas.0.jpg",\n        "geoCoordinates": {\n          "latitude": 36.0707,\n          "longitude": -115.1536\n        },\n        "ticketPricing": "Under $10 per person",\n        "rating": 4.6,\n        "bestTimeToVisit": "Avoid peak lunch/dinner hours for shorter lines",\n        "travelTimeFromPrevious": "10-15 minute drive"\n      }\n    },\n    "day2": {\n      "theme": "Downtown & Fremont Street Experience",\n      "morning": {\n        "placeName": "Downtown Las Vegas (Fremont Street)",\n        "placeDetails": "Explore the original Las Vegas.  See the historic casinos and soak in the old-school vibe.",\n        "placeImageUrl": "https://vegasexperience.com/wp-content/uploads/2023/09/fremontstreet_canopy.jpg",\n        "geoCoordinates": {\n          "latitude": 36.1700,\n          "longitude": -115.1400\n        },\n        "ticketPricing": "Free (except for gambling/attractions)",\n        "rating": 4.3,\n        "bestTimeToVisit": "Morning/Afternoon (less crowded than evening)",\n        "travelTimeFromHotel": "20-30 minute drive/bus ride from the Strip"\n      },\n      "afternoon": {\n        "placeName": "Fremont Street Experience",\n        "placeDetails": "Light and sound show projected onto the Viva Vision canopy.  Free to watch. Shows typically start in the evening, but the area is worth exploring during the day.",\n        "placeImageUrl": "https://downtownlv.com/wp-content/uploads/2020/08/Fremont_Street_Experience_8_1200x630.jpg",\n        "geoCoordinates": {\n          "latitude": 36.1700,\n          "longitude": -115.1400\n        },\n        "ticketPricing": "Free",\n        "rating": 4.5,\n        "bestTimeToVisit": "Evening (for the light show)",\n        "travelTimeFromPrevious": "Same location (Fremont Street)"\n      },\n      "evening": {\n        "placeName": "Container Park",\n        "placeDetails": "Unique outdoor shopping and dining area built from shipping containers.  Free to enter.  Offers a playground for kids (if applicable) and interesting art installations.",\n        "placeImageUrl": "https://downtownlv.com/wp-content/uploads/2020/08/Container_Park_1200x630.jpg",\n        "geoCoordinates": {\n          "latitude": 36.1682,\n          "longitude": -115.1377\n        },\n        "ticketPricing": "Free (except for shopping/dining)",\n        "rating": 4.2,\n        "bestTimeToVisit": "Evening (for a lively atmosphere)",\n        "travelTimeFromPrevious": "5-10 minute walk from Fremont Street"\n      },\n       "dinner": {\n        "placeName": "Heart Attack Grill",\n        "placeDetails": "Downtown restaurant known for its outrageous, high-calorie burgers and hospital theme.  A novelty experience.",\n        "placeImageUrl": "https://fastly.4sqi.net/img/general/600x600/5823900_hB0wB7B3Y3Bq3Q430K06N_0Q9k7_8o0xX6IqI8M_6Yg.jpg",\n        "geoCoordinates": {\n          "latitude": 36.1707,\n          "longitude": -115.1404\n        },\n        "ticketPricing": "$15-$30 per person",\n        "rating": 3.5,\n        "bestTimeToVisit": "Avoid peak lunch/dinner hours for shorter lines",\n        "travelTimeFromPrevious": "5 minute walk from Container Park"\n      }\n    },\n    "day3": {\n      "theme": "Exploring the Strip (North End & Free Activities)",\n      "morning": {\n        "placeName": "The Venetian & The Palazzo",\n        "placeDetails": "Explore the canals, bridges, and shops of this elaborate resort.  Free to walk around and admire the architecture.",\n        "placeImageUrl": "https://static.wixstatic.com/media/75467f_b3e30d75659c4a19a8905ca12832518a~mv2.jpg/v1/fill/w_640,h_480,al_c,q_80,usm_0.66_1.00_0.01/75467f_b3e30d75659c4a19a8905ca12832518a~mv2.jpg",\n        "geoCoordinates": {\n          "latitude": 36.1214,\n          "longitude": -115.1723\n        },\n        "ticketPricing": "Free (except for gondola rides/shopping/dining)",\n        "rating": 4.7,\n        "bestTimeToVisit": "Morning (less crowded)",\n        "travelTimeFromHotel": "Varies depending on hotel location (allow 15-30 minutes by car/bus)"\n      },\n      "afternoon": {\n        "placeName": "Mirage Volcano",\n        "placeDetails": "Dramatic volcano eruption show in front of the Mirage.  Free. Shows typically run in the evening, but check the schedule for daytime shows.",\n        "placeImageUrl": "https://www.wheretraveler.com/sites/default/files/images/Mirage_Volcano_3.jpg",\n        "geoCoordinates": {\n          "latitude": 36.1212,\n          "longitude": -115.1741\n        },\n        "ticketPricing": "Free",\n        "rating": 4.6,\n        "bestTimeToVisit": "Evening (for the full effect)",\n        "travelTimeFromPrevious": "5-10 minute walk from Venetian/Palazzo"\n      },\n      "evening": {\n        "placeName": "High Roller Observation Wheel (Optional)",\n        "placeDetails": "Giant Ferris wheel offering stunning views of the Strip.  Ticketed attraction.  Consider it if your budget allows.",\n        "placeImageUrl": "https://caesars.com/content/dam/highroller/high-roller-mobile.jpg",\n        "geoCoordinates": {\n          "latitude": 36.1155,\n          "longitude": -115.1698\n        },\n        "ticketPricing": "$25 - $37 per person (depending on time of day/discounts)",\n        "rating": 4.4,\n        "bestTimeToVisit": "Evening (for the lights)",\n        "travelTimeFromPrevious": "10-15 minute walk from Mirage Volcano"\n      },\n      "dinner": {\n        "placeName": "Secret Pizza (Cosmopolitan)",\n        "placeDetails": "Hidden pizza joint in the Cosmopolitan hotel. No signage. A cheap eats gem.",\n        "placeImageUrl": "https://assets.cntraveller.in/photos/6274316e9196eb4ac6140a81/16:9/w_1280,c_limit/LasVegas_SecretPizza_LEAD.jpg",\n        "geoCoordinates": {\n          "latitude": 36.1117,\n          "longitude": -115.1755\n        },\n        "ticketPricing": "$5 - $10 per slice",\n        "rating": 4.7,\n        "bestTimeToVisit": "Late Night (after shows, but expect a line)",\n        "travelTimeFromPrevious": "10-15 minute walk from High Roller (if you choose to do it)"\n      }\n    }\n  },\n  "budgetTips": [\n    "Take advantage of free attractions (Bellagio fountains, Conservatory, Fremont Street Experience).",\n    "Walk the Strip – it\'s the best way to see the sights.",\n    "Use public transportation (Deuce bus) or ride-sharing services for longer distances.",\n    "Look for happy hour deals and affordable dining options.",\n    "Bring your own water and snacks to avoid paying inflated prices.",\n    "Consider visiting during the off-season (summer or mid-week) for lower hotel rates."\n  ]\n}\n```\n\n**Important Notes and Considerations:**\n\n*   **Prices:** Hotel prices are approximate and fluctuate significantly based on the season, day of the week, and availability.  Check multiple booking sites for the best deals. Dining costs are also estimates.\n*   **Walking:**  Las Vegas is very walkable, but distances between attractions can be significant. Wear comfortable shoes.\n*   **Transportation:** The Deuce bus is a cost-effective way to travel up and down the Strip and downtown. Rideshares (Uber/Lyft) are also readily available.\n*   **Show Schedules:** Confirm show times for the Bellagio fountains, Mirage volcano, and Fremont Street Experience before your visit.\n*   **Flexibility:** This is a suggested itinerary.  Adjust it to your interests and energy levels.\n*   **Reservations:**  While not always necessary for budget dining, consider reservations for more popular restaurants, especially during peak hours.\n\nThis JSON structure provides a clear, organized, and detailed plan for a budget-friendly Las Vegas trip for a couple.  Remember to adapt it to your specific preferences and needs for the best possible experience.\n',
                },
            ],
        },
    ],
});

